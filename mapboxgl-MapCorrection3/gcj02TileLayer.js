!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).gcj02TileLayer=e()}(this,function(){"use strict";Object.freeze=function(t){return t};var t=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();var e=/\{ *([\w_-]+) *\}/g;var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=3.141592653589793,o=6378245,a=.006693421622965943;function n(t,e,r){var o=i/180*e,a=Math.pow(2,r);return[parseInt((t+180)/360*a),parseInt((1-Math.asinh(Math.tan(o))/i)/2*a)]}function s(t,e){if(r(t)){var n=t[0];e=t[1],t=n}if(t instanceof Object){n=t.lng;e=t.lat,t=n}var s=u(t-105,e-35),h=c(t-105,e-35),l=e/180*i,p=Math.sin(l);p=1-a*p*p;var f=Math.sqrt(p);return s=180*s/(o*(1-a)/(p*f)*i),{lng:t+(h=180*h/(o/f*Math.cos(l)*i)),lat:e+s}}function h(t,e){if(r(t)){var n=t[0];e=t[1],t=n}if(t instanceof Object){n=t.lng;e=t.lat,t=n}var s=function(t,e){var r=u(t-105,e-35),n=c(t-105,e-35),s=e/180*i,h=Math.sin(s);h=1-a*h*h;var l=Math.sqrt(h);return r=180*r/(o*(1-a)/(h*l)*i),n=180*n/(o/l*Math.cos(s)*i),{lng:t+n,lat:e+r}}(t,e);return{lng:2*t-s.lng,lat:2*e-s.lat}}function u(t,e){var r=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return r+=2*(20*Math.sin(6*t*i)+20*Math.sin(2*t*i))/3,r+=2*(20*Math.sin(e*i)+40*Math.sin(e/3*i))/3,r+=2*(160*Math.sin(e/12*i)+320*Math.sin(e*i/30))/3}function c(t,e){var r=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return r+=2*(20*Math.sin(6*t*i)+20*Math.sin(2*t*i))/3,r+=2*(20*Math.sin(t*i)+40*Math.sin(t/3*i))/3,r+=2*(150*Math.sin(t/12*i)+300*Math.sin(t/30*i))/3}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),t}var d={exports:{}};!function(t){function e(r){"@babel/helpers - typeof";return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=e=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),e(r)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}(d);var v=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(d.exports);function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function x(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,o,a=[],n=!0,s=!1;try{for(r=r.call(t);!(n=(i=r.next()).done)&&(a.push(i.value),!e||a.length!==e);n=!0);}catch(t){s=!0,o=t}finally{try{n||null==r.return||r.return()}finally{if(s)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var b,y=1e-6,P="undefined"!=typeof Float32Array?Float32Array:Array;function j(t,e,r){var i=e[0],o=e[1],a=e[2],n=e[3];return t[0]=r[0]*i+r[4]*o+r[8]*a+r[12]*n,t[1]=r[1]*i+r[5]*o+r[9]*a+r[13]*n,t[2]=r[2]*i+r[6]*o+r[10]*a+r[14]*n,t[3]=r[3]*i+r[7]*o+r[11]*a+r[15]*n,t}function w(t,e){var r,i,o,a=j([],e,t);return r=a,i=a,o=1/a[3],r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[3]=i[3]*o,a}function T(t,e,r){var i=e[0],o=e[1],a=e[2],n=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=e[9],f=e[10],d=e[11],v=e[12],_=e[13],m=e[14],M=e[15],g=r[0],x=r[1],b=r[2],y=r[3];return t[0]=g*i+x*s+b*l+y*v,t[1]=g*o+x*h+b*p+y*_,t[2]=g*a+x*u+b*f+y*m,t[3]=g*n+x*c+b*d+y*M,g=r[4],x=r[5],b=r[6],y=r[7],t[4]=g*i+x*s+b*l+y*v,t[5]=g*o+x*h+b*p+y*_,t[6]=g*a+x*u+b*f+y*m,t[7]=g*n+x*c+b*d+y*M,g=r[8],x=r[9],b=r[10],y=r[11],t[8]=g*i+x*s+b*l+y*v,t[9]=g*o+x*h+b*p+y*_,t[10]=g*a+x*u+b*f+y*m,t[11]=g*n+x*c+b*d+y*M,g=r[12],x=r[13],b=r[14],y=r[15],t[12]=g*i+x*s+b*l+y*v,t[13]=g*o+x*h+b*p+y*_,t[14]=g*a+x*u+b*f+y*m,t[15]=g*n+x*c+b*d+y*M,t}function E(t,e,r){var i,o,a,n,s,h,u,c,l,p,f,d,v=r[0],_=r[1],m=r[2];return e===t?(t[12]=e[0]*v+e[4]*_+e[8]*m+e[12],t[13]=e[1]*v+e[5]*_+e[9]*m+e[13],t[14]=e[2]*v+e[6]*_+e[10]*m+e[14],t[15]=e[3]*v+e[7]*_+e[11]*m+e[15]):(i=e[0],o=e[1],a=e[2],n=e[3],s=e[4],h=e[5],u=e[6],c=e[7],l=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=o,t[2]=a,t[3]=n,t[4]=s,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=p,t[10]=f,t[11]=d,t[12]=i*v+s*_+l*m+e[12],t[13]=o*v+h*_+p*m+e[13],t[14]=a*v+u*_+f*m+e[14],t[15]=n*v+c*_+d*m+e[15]),t}function A(t,e,r){var i=r[0],o=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function F(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],n=t[4],s=t[5],h=t[6],u=t[7],c=t[8],l=t[9],p=t[10],f=t[11],d=t[12],v=t[13],_=t[14],m=t[15],M=e[0],g=e[1],x=e[2],b=e[3],P=e[4],j=e[5],w=e[6],T=e[7],E=e[8],A=e[9],F=e[10],C=e[11],L=e[12],R=e[13],S=e[14],z=e[15];return Math.abs(r-M)<=y*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(i-g)<=y*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-x)<=y*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-b)<=y*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(n-P)<=y*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(s-j)<=y*Math.max(1,Math.abs(s),Math.abs(j))&&Math.abs(h-w)<=y*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(u-T)<=y*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-E)<=y*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-A)<=y*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(p-F)<=y*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(f-C)<=y*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-L)<=y*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(v-R)<=y*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(_-S)<=y*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(m-z)<=y*Math.max(1,Math.abs(m),Math.abs(z))}function C(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function L(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),b=new P(4),P!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),function(){var t,e=(t=new P(2),P!=Float32Array&&(t[0]=0,t[1]=0),t)}(),function(){var t,e=(t=new P(3),P!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}();var R=Math.PI,S=R/4,z=R/180,N=180/R,I=512,O=4003e4,U=1.5;function D(t){return Math.pow(2,t)}function Z(t,e){var r=x(t,2),i=r[0],o=r[1];L(Number.isFinite(i)&&Number.isFinite(e)),L(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");var a=o*z;return[(e*=I)*(i*z+R)/(2*R),e*(R-Math.log(Math.tan(S+.5*a)))/(2*R)]}function B(t,e){var r=x(t,2),i=r[0],o=r[1],a=i/(e*=I)*(2*R)-R,n=2*(Math.atan(Math.exp(R-o/e*(2*R)))-S);return[a*N,n*N]}function k(t){var e,r,i,o,a,n,s,h,u,c,l,p,f,d=t.height,v=t.pitch,_=t.bearing,m=t.altitude,M=t.center,g=void 0===M?null:M,x=t.flipY,b=void 0!==x&&x,y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return E(y,y,[0,0,-m]),A(y,y,[1,1,1/d]),e=y,r=y,i=-v*z,o=Math.sin(i),a=Math.cos(i),n=r[4],s=r[5],h=r[6],u=r[7],c=r[8],l=r[9],p=r[10],f=r[11],r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=n*a+c*o,e[5]=s*a+l*o,e[6]=h*a+p*o,e[7]=u*a+f*o,e[8]=c*a-n*o,e[9]=l*a-s*o,e[10]=p*a-h*o,e[11]=f*a-u*o,function(t,e,r){var i=Math.sin(r),o=Math.cos(r),a=e[0],n=e[1],s=e[2],h=e[3],u=e[4],c=e[5],l=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*o+u*i,t[1]=n*o+c*i,t[2]=s*o+l*i,t[3]=h*o+p*i,t[4]=u*o-a*i,t[5]=c*o-n*i,t[6]=l*o-s*i,t[7]=p*o-h*i}(y,y,_*z),b&&A(y,y,[1,-1,1]),g&&E(y,y,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],g)),y}function X(t){var e=t.width,r=t.height,i=t.pitch,o=function(t){var e=t.width,r=t.height,i=t.altitude,o=void 0===i?U:i,a=t.pitch,n=void 0===a?0:a,s=t.nearZMultiplier,h=void 0===s?1:s,u=t.farZMultiplier,c=void 0===u?1:u,l=n*z,p=Math.atan(.5/o),f=Math.sin(p)*o/Math.sin(Math.PI/2-l-p),d=Math.cos(Math.PI/2-l)*f+o;return{fov:2*Math.atan(r/2/o),aspect:e/r,focalDistance:o,near:h,far:d*c}}({width:e,height:r,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return function(t,e,r,i,o){var a,n=1/Math.tan(e/2);return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(a=1/(i-o),t[10]=(o+i)*a,t[14]=2*o*i*a):(t[10]=-1,t[14]=-2*i),t}([],o.fov,o.aspect,o.near,o.far)}function G(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=x(t,3),o=i[0],a=i[1],n=i[2];if(L(Number.isFinite(o)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(n))return w(e,[o,a,n,1]);var s=w(e,[o,a,0,1]),h=w(e,[o,a,1,1]),u=s[2],c=h[2];return function(t,e,r,i){var o=e[0],a=e[1];return t[0]=o+i*(r[0]-o),t[1]=a+i*(r[1]-a),t}([],s,h,u===c?0:((r||0)-u)/(c-u))}var K=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,i=e.height,o=e.viewMatrix,a=void 0===o?K:o,n=e.projectionMatrix,s=void 0===n?K:n;l(this,t),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];T(h,h,this.projectionMatrix),T(h,h,this.viewMatrix),this.viewProjectionMatrix=h;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];A(u,u,[this.width/2,-this.height/2,1]),E(u,u,[1,-1,0]),T(u,u,this.viewProjectionMatrix);var c,p,f,d,v,_,m,M,g,x,b,y,P,j,w,F,C,L,R,S,z,N,I,O,U,D,Z,B,k,X,G,Y=(c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=(p=u)[0],d=p[1],v=p[2],_=p[3],m=p[4],M=p[5],g=p[6],x=p[7],b=p[8],y=p[9],P=p[10],j=p[11],w=p[12],F=p[13],C=p[14],L=p[15],(G=(R=f*M-d*m)*(X=P*L-j*C)-(S=f*g-v*m)*(k=y*L-j*F)+(z=f*x-_*m)*(B=y*C-P*F)+(N=d*g-v*M)*(Z=b*L-j*w)-(I=d*x-_*M)*(D=b*C-P*w)+(O=v*x-_*g)*(U=b*F-y*w))?(G=1/G,c[0]=(M*X-g*k+x*B)*G,c[1]=(v*k-d*X-_*B)*G,c[2]=(F*O-C*I+L*N)*G,c[3]=(P*I-y*O-j*N)*G,c[4]=(g*Z-m*X-x*D)*G,c[5]=(f*X-v*Z+_*D)*G,c[6]=(C*z-w*O-L*S)*G,c[7]=(b*O-P*z+j*S)*G,c[8]=(m*k-M*Z+x*U)*G,c[9]=(d*Z-f*k-_*U)*G,c[10]=(w*I-F*z+L*R)*G,c[11]=(y*z-b*I-j*R)*G,c[12]=(M*D-m*B-g*U)*G,c[13]=(f*B-d*D+v*U)*G,c[14]=(F*S-w*N-C*R)*G,c[15]=(b*N-y*S+P*R)*G,c):null);if(!Y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=u,this.pixelUnprojectionMatrix=Y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return f(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&F(e.projectionMatrix,this.projectionMatrix)&&F(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,i=function(t,e){var r=x(t,3),i=r[0],o=r[1],a=r[2],n=void 0===a?0:a;return L(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(n)),w(e,[i,o,n,1])}(this.projectPosition(t),this.pixelProjectionMatrix),o=x(i,2),a=o[0],n=o[1],s=r?n:this.height-n;return 2===t.length?[a,s]:[a,s,i[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,i=void 0===r||r,o=e.targetZ,a=x(t,3),n=a[0],s=a[1],h=a[2],u=i?s:this.height-s,c=o&&o*this.pixelsPerMeter,l=G([n,u,h],this.pixelUnprojectionMatrix,c),p=x(this.unprojectPosition(l),3),f=p[0],d=p[1],v=p[2];return Number.isFinite(h)?[f,d,v]:Number.isFinite(o)?[f,d,o]:[f,d]}},{key:"projectPosition",value:function(t){var e=x(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=x(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}}]),t}();function q(t){var e=t.width,r=t.height,i=t.bounds,o=t.minExtent,a=void 0===o?0:o,n=t.maxZoom,s=void 0===n?24:n,h=t.padding,u=void 0===h?0:h,c=t.offset,l=void 0===c?[0,0]:c,p=x(i,2),f=x(p[0],2),d=f[0],v=f[1],_=x(p[1],2),m=_[0],M=_[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else L(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var g=new W({width:e,height:r,longitude:0,latitude:0,zoom:0}),b=g.project([d,M]),y=g.project([m,v]),P=[Math.max(Math.abs(y[0]-b[0]),a),Math.max(Math.abs(y[1]-b[1]),a)],j=[e-u.left-u.right-2*Math.abs(l[0]),r-u.top-u.bottom-2*Math.abs(l[1])];L(j[0]>0&&j[1]>0);var w=j[0]/P[0],T=j[1]/P[1],E=(u.right-u.left)/2/w,A=(u.bottom-u.top)/2/T,F=[(y[0]+b[0])/2+E,(y[1]+b[1])/2+A],C=g.unproject(F),R=g.zoom+Math.log2(Math.abs(Math.min(w,T)));return{longitude:C[0],latitude:C[1],zoom:Math.min(R,s)}}var W=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.width,o=r.height,a=r.latitude,n=void 0===a?0:a,s=r.longitude,h=void 0===s?0:s,u=r.zoom,c=void 0===u?0:u,p=r.pitch,f=void 0===p?0:p,d=r.bearing,M=void 0===d?0:d,g=r.altitude,x=void 0===g?1.5:g,b=r.nearZMultiplier,y=r.farZMultiplier;l(this,e),i=i||1,o=o||1;var P=D(c);x=Math.max(.75,x);var j=Z([h,n],P);j[2]=0;var w,T,E=X({width:i,height:o,pitch:f,bearing:M,altitude:x,nearZMultiplier:b||1/o,farZMultiplier:y||1.01}),A=k({height:o,center:j,pitch:f,bearing:M,altitude:x,flipY:!0});return w=this,(t=!(T=m(e).call(this,{width:i,height:o,viewMatrix:A,projectionMatrix:E}))||"object"!==v(T)&&"function"!=typeof T?_(w):T).latitude=n,t.longitude=h,t.zoom=c,t.pitch=f,t.bearing=M,t.altitude=x,t.scale=P,t.center=j,t.pixelsPerMeter=function(t){var e=t.latitude,r=t.longitude,i=t.zoom,o=t.scale,a=t.highPrecision,n=void 0!==a&&a;o=void 0!==o?o:D(i),L(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(o));var s={},h=I*o,u=Math.cos(e*z),c=h/360,l=c/u,p=h/O/u;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-l,p],s.degreesPerPixel=[1/c,-1/l,1/p],n){var f=z*Math.tan(e*z)/u,d=c*f/2,v=h/O*f,_=v/l*p;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[_,0,_]}return s}(_(_(t))).pixelsPerMeter[2],Object.freeze(_(_(t))),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(e,Y),f(e,[{key:"projectFlat",value:function(t){return Z(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return B(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,r,i=t.lngLat,o=G(t.pos,this.pixelUnprojectionMatrix),a=C([],Z(i,this.scale),((e=[])[0]=-(r=o)[0],e[1]=-r[1],e));return B(C([],this.center,a),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,o=this.height,a=q(Object.assign({width:i,height:o,bounds:t},r));return new e({width:i,height:o,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}();const H=Math.PI/180,V=512,$=4003e4;function J(t){return Math.pow(2,t)}return class{constructor(e,r,i){this.id=e,this.type="custom",this.renderingMode="2d",this.url=r,this.options={subdomains:null,imgLoadRender:!1,minZoom:3,maxZoom:18},function(e,r){for(var i in e.hasOwnProperty("options")||(e.options=e.options?t(e.options):{}),r)e.options[i]=r[i];e.options}(this,i),this.program,this.showTiles=[],this.tileCache={},this.gridCache={},this.matrix,this.map}onAdd(t,e){this.map=t;var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_TextCoord;varying vec2 v_TextCoord;const float TILE_SIZE = 512.0;const float PI = 3.1415926536;const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);uniform float u_project_scale;uniform bool u_is_offset;uniform vec3 u_pixels_per_degree;uniform vec3 u_pixels_per_degree2;uniform vec3 u_pixels_per_meter;uniform vec2 u_viewport_center;uniform vec4 u_viewport_center_projection;uniform vec2 u_viewport_size;float project_scale(float meters) {    return meters * u_pixels_per_meter.z;}vec3 project_scale(vec3 position) {    return position * u_pixels_per_meter;}vec2 project_mercator(vec2 lnglat) {    float x = lnglat.x;    return vec2(    radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))    );}vec4 project_offset(vec4 offset) {    float dy = offset.y;    dy = clamp(dy, -1., 1.);    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;    return vec4(offset.xyz * pixels_per_unit, offset.w);}vec4 project_position(vec4 position) {    if (u_is_offset) {        float X = position.x - u_viewport_center.x;        float Y = position.y - u_viewport_center.y;        return project_offset(vec4(X, Y, position.z, position.w));    }    else {        return vec4(        project_mercator(position.xy) * WORLD_SCALE * u_project_scale, project_scale(position.z), position.w        );    }}vec4 project_to_clipping_space(vec3 position) {    vec4 project_pos = project_position(vec4(position, 1.0));    return u_matrix * project_pos + u_viewport_center_projection;}void main() {   vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));   gl_Position = u_matrix * project_pos + u_viewport_center_projection;   v_TextCoord = a_TextCoord;}"),e.compileShader(r);var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,"precision mediump float;uniform sampler2D u_Sampler; varying vec2 v_TextCoord; void main() {   gl_FragColor = texture2D(u_Sampler, v_TextCoord);}"),e.compileShader(i),this.program=e.createProgram(),e.attachShader(this.program,r),e.attachShader(this.program,i),e.linkProgram(this.program),this.a_Pos=e.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=e.getAttribLocation(this.program,"a_TextCoord"),t.on("move",()=>{this.update(e,t)}),this.update(e,t)}update(t,e){for(var r=e.getCenter(),i=parseInt(e.getZoom())+1,o=e.getBounds(),a=s(o.getNorthWest()),h=s(o.getSouthEast()),u=n(a.lng,a.lat,i),c=n(h.lng,h.lat,i),l=[],p=u[0];p<=c[0];p++)for(var f=u[1];f<=c[1];f++){var d={x:p,y:f,z:i};l.push(d),this.addGridCache(d,0,0),p===c[0]&&this.addGridCache(d,1,0),f===c[1]&&this.addGridCache(d,0,1),p===c[0]&&f===c[1]&&this.addGridCache(d,1,1)}var v=n(r.lng,r.lat,i);for(var d of(l.sort((t,e)=>this.tileDistance(t,v)-this.tileDistance(e,v)),this.showTiles=[],l))if(this.tileCache[this.createTileKey(d)])this.showTiles.push(this.tileCache[this.createTileKey(d)]);else{var _=this.createTile(t,d);this.showTiles.push(_),this.tileCache[this.createTileKey(d)]=_}}addGridCache(t,e,r){var o=this.createTileKey(t.x+e,t.y+r,t.z);this.gridCache[o]||(this.gridCache[o]=h(function(t,e,r){let o=Math.pow(2,r);return[t/o*360-180,180*Math.atan(Math.sinh(i*(1-2*e/o)))/i]}(t.x+e,t.y+r,t.z)))}tileDistance(t,e){return Math.sqrt(Math.pow(t.x-e[0],2)+Math.pow(t.y-e[1],2))}createTileKey(t,e,r){return t instanceof Object?t.z+"/"+t.x+"/"+t.y:r+"/"+t+"/"+e}createTile(t,r){var i,o,a=(i=this.url,o={s:this.options.subdomains[Math.abs(r.x+r.y)%this.options.subdomains.length],x:r.x,y:r.y,z:r.z},i.replace(e,function(t,e){var r=o[e];if(void 0===r)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(o)),r})),n={xyz:r},s=this.gridCache[this.createTileKey(r)],h=this.gridCache[this.createTileKey(r.x+1,r.y,r.z)],u=this.gridCache[this.createTileKey(r.x,r.y+1,r.z)],c=this.gridCache[this.createTileKey(r.x+1,r.y+1,r.z)],l=new Float32Array([s.lng,s.lat,0,1,u.lng,u.lat,0,0,h.lng,h.lat,1,1,c.lng,c.lat,1,0]),p=l.BYTES_PER_ELEMENT,f=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),n.buffer=f,n.PosParam={size:2,stride:4*p,offset:0},n.TextCoordParam={size:2,stride:4*p,offset:2*p};var d=new Image;return d.onload=(()=>{n.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,d),n.isLoad=!0,this.options.imgLoadRender&&this.render(t,this.matrix)}),d.crossOrigin=!0,d.src=a,n}render(t,e){if(!(this.map.getZoom()<this.options.minZoom||this.map.getZoom()>this.options.maxZoom))for(var r of(this.matrix=e,t.useProgram(this.program),this.showTiles))if(r.isLoad){t.bindTexture(t.TEXTURE_2D,r.texture),t.activeTexture(t.TEXTURE0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT);var i=t.getUniformLocation(this.program,"u_Sampler");t.uniform1i(i,0),t.bindBuffer(t.ARRAY_BUFFER,r.buffer),t.vertexAttribPointer(this.a_Pos,r.PosParam.size,t.FLOAT,!1,r.PosParam.stride,r.PosParam.offset),t.vertexAttribPointer(this.a_TextCoord,r.TextCoordParam.size,t.FLOAT,!1,r.TextCoordParam.stride,r.TextCoordParam.offset),t.enableVertexAttribArray(this.a_Pos),t.enableVertexAttribArray(this.a_TextCoord),this.setVertex(t),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}setVertex(t){const e=this.map.getZoom(),r=this.map.getBearing(),i=this.map.getPitch(),o=this.map.getCenter(),a=new W({width:t.drawingBufferWidth,height:t.drawingBufferHeight,longitude:o.lng,latitude:o.lat,zoom:e,pitch:i,bearing:r}),{viewProjectionMatrix:n,projectionMatrix:s,viewMatrix:h,viewMatrixUncentered:u}=a;let c={u_matrix:n,u_point_size:this.pointSize,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_project_scale:J(e),u_viewport_center_projection:[0,0,0,0]};if(e>12){const{pixelsPerDegree:t,pixelsPerDegree2:r}=function(t){let{latitude:e=0,zoom:r=1,scale:i,highPrecision:o=!1}=t;i=void 0!==i?i:J(r);const a={},n=V*i,s=Math.cos(e*H),h=n/360,u=h/s,c=n/$/s;if(a.pixelsPerMeter=[c,-c,c],a.metersPerPixel=[1/c,-1/c,1/c],a.pixelsPerDegree=[h,-u,c],a.degreesPerPixel=[1/h,-1/u,1/c],o){const t=H*Math.tan(e*H)/s,r=h*t/2,i=n/$*t,o=i/u*c;a.pixelsPerDegree2=[0,-r,i],a.pixelsPerMeter2=[o,0,o]}return a}({longitude:o.lng,latitude:o.lat,zoom:e,highPrecision:!0}),i=a.projectFlat([Math.fround(o.lng),Math.fround(o.lat)],Math.pow(2,e)),l=j([],[i[0],i[1],0,1],n);let p=T([],s,u||h);p=T([],p,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),c.u_matrix=p,c.u_is_offset=!0,c.u_viewport_center=[Math.fround(o.lng),Math.fround(o.lat)],c.u_viewport_center_projection=l,c.u_pixels_per_degree=t&&t.map(t=>Math.fround(t)),c.u_pixels_per_degree2=r&&r.map(t=>Math.fround(t))}t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_matrix"),!1,c.u_matrix),t.uniform1f(t.getUniformLocation(this.program,"u_project_scale"),c.u_project_scale),t.uniform1i(t.getUniformLocation(this.program,"u_is_offset"),c.u_is_offset?1:0),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree"),c.u_pixels_per_degree),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree2"),c.u_pixels_per_degree2),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_meter"),c.u_pixels_per_meter),t.uniform2fv(t.getUniformLocation(this.program,"u_viewport_center"),c.u_viewport_center),t.uniform4fv(t.getUniformLocation(this.program,"u_viewport_center_projection"),c.u_viewport_center_projection)}}});